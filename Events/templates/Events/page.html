{% extends 'base.html' %}

{% block title %}
{{events.title}}
{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12">
      <div class="page-header">
        <h1 style="text-align: center">
          {{events.name}} <small>{{events.name}}</small>		
        </h1>
      </div>
		<br><br>
		{% if request.session.auth > 0 %}		  
		  <button class="btn btn-default" type='button' disabled="disabled" onclick="location.href='/events/next/{{events.id}}'">下一阶段</button>
		  <button class="btn btn-default" data-toggle="modal" data-target="#myModal">删除该赛事</button>
		  <button class="btn btn-default"
              onclick="location.href='/events/setprizes/{{events.id}}'">设置奖项</button>
		{% endif %}
		  <button class="btn btn-default"
              onclick="location.href='/events/qrcode/{{events.id}}'">生成报名二维码</button>
		  <button class="btn btn-success" onclick="location.href='/events/viewprizes/{{events.id}}'" style="float:right">查看获奖</button>
		  <button class="btn btn-success" onclick="location.href='/record/{{events.id}}'" style="float:right">查看报名</button>
	  <br><br><br>
	  <div class="ystep1"></div>	  
	  <br><br><br>
      <div id="status" class="alert alert-{{events.s3}}">
        {{events.s2}}
      </div>
      <dl class="dl-horizontal">
        <dt>
          比赛时间
        </dt>
        <dd>
          {{events.date}}
        </dd>
        <dt>
          详细信息
        </dt>
        <dd>
          {{events.content}}
        </dd>
      </dl>	  
      <nav style="text-align: center; margin-bottom:20px"> 
		<button class="btn btn-primary" {% if not events.status == 2 %} name="sign" disabled="disabled"{% endif %}
				{% if events.teamMode == 1 %} data-toggle="modal" data-target="#myModalPro" {% else %} onclick="location.href='/events/sign/{{events.id}}/'" {% endif%}>立即报名</button>
		<button class="btn btn-link" {% if not events.status == 2 %} name="sign" disabled="disabled"{% endif %} onclick="location.href='/events/design/{{events.id}}/'" >取消报名</button>
	    </form>
	  </nav>
	  <!--{% if request.session.username %}
      <nav style="text-align: center; margin-bottom:20px"> 
        <button id="register" class="btn btn-primary" type="button"
        {% if signed %} disabled="disabled"{% endif %} onclick="register()">立即报名</button>
      </nav>
	  {% endif %}-->
    </div>
  </div>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" 
						aria-hidden="true">×
				</button>
				<h3 class="modal-title" id="myModalLabel">
					删除赛事
				</h3>
			</div>
			<div class="modal-body">
				是否删除该赛事
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" onclick="delevents()">
					确认
				</button>
				<button type="button" class="btn btn-default" 
						data-dismiss="modal">取消
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div>
<script type="text/javascript">
 function delevents()
 {
	alert("删除该赛事！");
	location.href="/events/delete/{{events.id}}/";
 }
</script>


<div class="modal fade" id="myModalPro" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">×
				</button>
				<h3 class="modal-title" id="myModalProLabel">
					组建团队
				</h3>
			</div>
			<div class="modal-body">
				查找用户添加队友
			</div>
			<nav style="text-align: center; margin-bottom:20px">
				<form role="form" class="form-inline" action="/managers/" method="post" >
					<div class="form-group">
						<label for="name">名称：</label>
						<input type="text" class="form-control" id="name" name="name"
							   placeholder="请输入用户名">
					</div>
					<button type="submit" class="btn btn-default" onclick="finduser()">查找</button>
				</form>
				<div>
					<table class="table table-hover">
						<thead>
						<tr>
							<th>
								用户名
							</th>
							<th>
								姓名
							</th>
							<th>
								关系
							</th>
						</tr>
						</thead>
						<tbody>
						{% for member in member_list %}
						<tr class="success">
							<td>
								<a href="/user/{{member.id}}">{{member.name}}</a>
							</td>
							<td>
								{{member.fullname}}
							</td>
							<td>
								{%if member.id == user_now.id %}
								队长
								{% else %}
								队员
								{% endif %}
							</td>
						</tr>
						{% endfor %}
						</tbody>
					</table>
				</div>
			</nav>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" onclick="teamsign()">
					确认
				</button>
				<button type="button" class="btn btn-default"
						data-dismiss="modal">取消
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div>
<script type="text/javascript">
 function teamsign()
 {
	alert("团队报名！！！！");
	location.href="/events/teamsign/{{events.id}}/";
 }
</script>


<script src="/static/js/ystep.js"></script>
<script type="text/javascript">
$(".ystep1").loadStep({
      size: "large",
      color: "blue",
      steps: [{
        title: "即将开始",
        content: "报名即将开始"
      },{
        title: "正在报名",
        content: "报名后等待审核"
      },{
        title: "等待比赛",
        content: "报名已截止，请等待比赛。"
      },{
        title: "比赛结束",
        content: "比赛已结束，请查看成绩"
      }]
    });
$(".ystep1").setStep({{events.status}});
</script>

{% endblock %}
